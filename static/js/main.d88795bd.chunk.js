(this.webpackJsonpblindtestwitch=this.webpackJsonpblindtestwitch||[]).push([[0],{106:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return r}));var c=n(30),a=n(107),s=function e(t,n){Object(c.a)(this,e),this.codeVerifier=void 0,this.codeChallenge=void 0,this.codeVerifier=t,this.codeChallenge=n},i=function(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},r=function(){var t,n=i(Object(a.randomBytes)(64)),c=i((t=e.from(n),Object(a.createHash)("sha256").update(t).digest()));return new s(n,c)}}).call(this,n(16).Buffer)},173:function(e,t){},207:function(e,t,n){},208:function(e,t,n){},234:function(e,t){},236:function(e,t){},246:function(e,t){},248:function(e,t){},273:function(e,t){},274:function(e,t){},279:function(e,t){},281:function(e,t){},288:function(e,t){},307:function(e,t){},324:function(e,t,n){},332:function(e,t){},351:function(e,t){},388:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),s=n(36),i=n.n(s),r=(n(207),n(3)),u=(n(208),n(44)),o=n(194),l=n(75),d=n(20);u.b.add(o.a,d.c,l.b,d.e,d.j,d.k,d.p,d.a,d.d,d.n,d.g,d.h,d.f,d.i,d.n,d.b,d.l,d.o,d.m,l.a,l.c);var h=n(9),j=n(394),b=n(393),f=n(12),p=n(10),O=n.n(p),m=n(17),x=n(195),g=n.n(x),v=n(54),D=n(30),y=function e(t,n,c){Object(D.a)(this,e),this.original=void 0,this.toGuess=void 0,this.maxDistance=void 0,this.original=t,this.toGuess=n,this.maxDistance=c},C=function e(t,n,c,a,s){Object(D.a)(this,e),this.title=void 0,this.artists=void 0,this.uri=void 0,this.img=void 0,this.offset=void 0,this.title=t,this.artists=n,this.uri=c,this.offset=a,this.img=s},k=function e(t){if(Object(D.a)(this,e),this.tracks=[],this.doneTracks=0,t){var n,c=Object(v.a)(t);try{for(c.s();!(n=c.n()).done;){var a=n.value.track,s=a.artists.map((function(e){return e.name})),i=V(a.name,s);this.tracks.push(new C(F(i),a.artists.map((function(e){return F(e.name)})),a.album.uri,a.track_number-1,a.album.images[1].url))}}catch(r){c.e(r)}finally{c.f()}}},F=function(e){var t=Y(e),n=q(t);return new y(e,t,n)},A=n(37),w=n(106),B=n(55),E=function(){function e(t,n,c,a){Object(D.a)(this,e),this.twitchChannel=void 0,this.deviceId=void 0,this.addEveryUser=void 0,this.chatNotifications=void 0,this.twitchChannel=t,this.deviceId=n,this.addEveryUser=c,this.chatNotifications=a}return Object(B.a)(e,[{key:"isInitialized",value:function(){return void 0!==this.twitchChannel&&void 0!==this.deviceId}}]),e}(),S=function(){return new URL(window.location.href).origin+"/BlindTesTwitch"},I=function(e,t){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&#]"+e+"=([^&#]*)").exec(t);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},_=function(){return console.log("getTwitchOAuthToken"),localStorage.getItem("twitch_oauth_token")},N=function(){return localStorage.getItem("refresh_token")},z=function(e){localStorage.setItem("refresh_token",e)},L=function(e){localStorage.setItem("access_token",e)},T=function(){localStorage.removeItem("access_token")},P=function(){return Object(A.a)(E,localStorage.getItem("settings")||"{}")},M=function(){return new Map(Object.entries(JSON.parse(localStorage.getItem("blind_test_scores")||"{}")))},R=function(){localStorage.removeItem("blind_test_scores")},G=function(){localStorage.removeItem("blind_test_tracks")},U=function(e){localStorage.setItem("blind_test_tracks",Object(A.b)(e))},Y=function(e){return H(e).replaceAll(/ \(.+\).*| -.+/g,"").trim()},H=function(e){return e.toLowerCase().normalize("NFD").replaceAll(/(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u0898-\u089F\u08C9-\u08D2\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C3C\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u1714\u1715\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABE\u1AC1-\u1ACB\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD801[\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50\uDF82-\uDF85]|\uD804[\uDC46\uDC70\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD833[\uDF00-\uDF2D\uDF30-\uDF46]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEAE\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])/g,"").replaceAll(/[,!?:;.]/g,"").replaceAll("\u2019","'").trim()},V=function(e,t){var n,c=e,a=Object(v.a)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,i=new RegExp(" \\(.*".concat(s,".*\\)| \\[.*").concat(s,".*\\]| - .*").concat(s,".*"),"gi");c=c.replaceAll(i,"").trim()}}catch(r){a.e(r)}finally{a.f()}return c},q=function(e){return Math.floor(Math.max(0,e.length-3)/6)},J=function(e,t){var n=e.length,c=t.length;if(0===n)return c;if(0===c)return n;for(var a=new Array(n+1),s=0;s<=n;++s)a[s]=new Array(c+1).fill(0);for(var i=0;i<n+1;i++)a[i][0]=i;for(var r=0;r<c+1;r++)a[0][r]=r;for(var u=1;u<n+1;u++)for(var o=1;o<c+1;o++){var l=e.charAt(u-1)===t.charAt(o-1)?0:1;" "!==e.charAt(u-1)||"-"!==t.charAt(o-1)&&"'"!==t.charAt(o-1)||(l=0),a[u][o]=Math.min(a[u-1][o]+1,a[u][o-1]+1,a[u-1][o-1]+l),u>1&&o>1&&e.charAt(u-1)===t.charAt(o-2)&&e.charAt(u-2)===t.charAt(o-1)&&(a[u][o]=Math.min(a[u][o],a[u-2][o-2]+l))}return a[n][c]},K=g.a.create({headers:{"Content-Type":"application/json"}}),W=function(){};K.interceptors.response.use((function(e){return e}),function(){var e=Object(m.a)(O.a.mark((function e(t){var n,c,a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.config,!t.response){e.next=27;break}if(401!==t.response.status||n._retry){e.next=26;break}return delete K.defaults.headers.common.Authorization,T(),n._retry=!0,e.prev=6,(c=new URLSearchParams).append("grant_type","refresh_token"),c.append("refresh_token",N()||""),c.append("client_id","f506a08aeb884e5681af80943d17ea46"),e.next=13,K.post("https://accounts.spotify.com/api/token",c,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 13:return a=e.sent,z(a.data.refresh_token),s=a.data.access_token,L(s),K.defaults.headers.common.Authorization="Bearer ".concat(s),n.headers.Authorization="Bearer ".concat(s),e.abrupt("return",K(n));case 22:return e.prev=22,e.t0=e.catch(6),X(t),e.abrupt("return",Promise.reject(e.t0));case 26:X(t);case 27:return e.abrupt("return",Promise.reject(t));case 28:case"end":return e.stop()}}),e,null,[[6,22]])})));return function(t){return e.apply(this,arguments)}}());var X=function(e){W(e.response.status+(e.response.data&&" "+JSON.stringify(e.response.data)))},Q=function(e){var t=new URLSearchParams,n=function(){var e=Object(A.a)(w.a,localStorage.getItem("pkce_pair")||"{}");return localStorage.removeItem("pkce_pair"),e}();return t.append("code",e),t.append("redirect_uri",S()+"/callback"),t.append("grant_type","authorization_code"),t.append("code_verifier",n.codeVerifier),t.append("client_id","f506a08aeb884e5681af80943d17ea46"),K.post("https://accounts.spotify.com/api/token",t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},Z=localStorage.getItem("access_token");Z&&(K.defaults.headers.common.Authorization="Bearer ".concat(Z));var $=K,ee=n(0),te=function(){var e=Object(c.useContext)(Fe).setSubtitle;Object(c.useEffect)((function(){e("Play Blind-Test on Twitch !")}),[e]);return Object(ee.jsxs)(b.a,{id:"loginButton",type:"submit",variant:"outline-secondary",size:"lg",onClick:function(){var e=function(){var e=Object(w.b)();return localStorage.setItem("pkce_pair",Object(A.b)(e)),e}();window.location.href="https://accounts.spotify.com/authorize?client_id=f506a08aeb884e5681af80943d17ea46&redirect_uri="+S()+"/callback&scope=playlist-read-private%20user-modify-playback-state%20user-read-playback-state&response_type=code&code_challenge_method=S256&code_challenge="+e.codeChallenge+"&show_dialog=true"},children:[Object(ee.jsx)(f.a,{icon:["far","check-circle"],size:"sm"})," Login with Spotify"]})},ne=function(e,t){return $.get("https://api.spotify.com/v1/me/playlists?offset=".concat(e,"&limit=").concat(t))},ce=function(e,t,n){return $.get("https://api.spotify.com/v1/playlists/".concat(e,"/tracks?offset=").concat(t,"&limit=").concat(n,"&fields=items(track(track_number,name,artists(name),album(uri,images)))"))},ae=function(e,t){return $.put("https://api.spotify.com/v1/me/player/repeat?device_id=".concat(t,"&state=").concat(e?"track":"off"))},se=n(25),ie=function(){var e=Object(c.useContext)(Fe),t=e.setConfigured,n=e.setSubtitle,a=Object(h.f)(),s=Object(c.useState)((function(){return P()})),i=Object(r.a)(s,1)[0],u=Object(c.useState)(!1),o=Object(r.a)(u,2),l=o[0],d=o[1],j=Object(c.useState)(!1),f=Object(r.a)(j,2),p=f[0],O=f[1],m=Object(c.useState)([]),x=Object(r.a)(m,2),g=x[0],v=x[1],D=Object(c.useState)(""),y=Object(r.a)(D,2),C=y[0],k=y[1],F=Object(c.useState)((function(){return null!==_()})),w=Object(r.a)(F,2),B=w[0],N=w[1],z=Object(c.useState)(i.chatNotifications||!1),L=Object(r.a)(z,2),T=L[0],M=L[1],R=Object(c.useState)(i.addEveryUser||!1),G=Object(r.a)(R,2),U=G[0],Y=G[1],H=Object(c.useState)(i.twitchChannel||""),V=Object(r.a)(H,2),q=V[0],J=V[1],K="https://id.twitch.tv/oauth2/authorize?client_id=n30lxnak8nbxtibb6m69c9kh66c7v8&redirect_uri="+S()+"/settings&scope=chat:read+chat:edit+channel:moderate+whispers:read+whispers:edit+channel_editor&response_type=token";Object(c.useEffect)((function(){console.log("main useEffect");var e,t=I("access_token",window.location.hash);t&&(e=t,localStorage.setItem("twitch_oauth_token",e),N(!0),a("/settings")),n("Settings"),$.get("https://api.spotify.com/v1/me/player/devices").then((function(e){v(e.data.devices);var t=e.data.devices.find((function(e){return e.id===i.deviceId}));t&&k(t.id),O(!0)}))}),[]);return p?Object(ee.jsx)("div",{style:{width:"600px",margin:"auto"},children:Object(ee.jsxs)(se.a,{noValidate:!0,validated:l,onSubmit:function(e){var n;e.preventDefault(),e.stopPropagation(),!0===e.currentTarget.checkValidity()&&(n=new E(q,C,U,T),localStorage.setItem("settings",Object(A.b)(n)),t(!0),a("/")),d(!0)},children:[Object(ee.jsxs)(se.a.Group,{className:"mb-3",controlId:"formGroupTwitch",children:[Object(ee.jsx)(se.a.Label,{children:"Twitch channel"}),Object(ee.jsx)(se.a.Control,{required:!0,value:q,onChange:function(e){J(e.target.value)},type:"text",placeholder:"Enter twitch channel"})]}),Object(ee.jsxs)(se.a.Group,{className:"mb-3",controlId:"formGroupDevice",children:[Object(ee.jsx)(se.a.Label,{children:"Playing device"}),Object(ee.jsxs)(se.a.Select,{required:!0,className:"form-control",value:C,onChange:function(e){k(e.target.value)},children:[Object(ee.jsx)("option",{value:"",children:"Select device..."}),g.map((function(e){return Object(ee.jsxs)("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id)}))]})]}),Object(ee.jsxs)(se.a.Group,{className:"mb-3",controlId:"formGroupChatNotifications",children:[Object(ee.jsx)(se.a.Check,{disabled:!B,type:"checkbox",checked:B&&T,label:"Display guess notifications in the chat",onChange:function(e){M(e.target.checked)}}),Object(ee.jsxs)(ee.Fragment,{children:[!B&&Object(ee.jsxs)(se.a.Text,{id:"twitchLoginBlock",muted:!0,children:["You need to log in to twitch to use that feature. ",Object(ee.jsx)("a",{href:K,children:"Click here to log in"})]}),B&&Object(ee.jsx)(se.a.Text,{id:"twitchLogoutBlock",onClick:function(){localStorage.removeItem("twitch_oauth_token"),N(!1)},muted:!0,children:Object(ee.jsx)("a",{href:"#",children:"Log out from twitch"})})]})]}),Object(ee.jsx)(se.a.Group,{className:"mb-3",controlId:"formGroupAddEveryUser",children:Object(ee.jsx)(se.a.Check,{type:"checkbox",checked:U,label:"Add every speaking viewer in the leaderboard",onChange:function(e){Y(e.target.checked)}})}),Object(ee.jsx)(b.a,{variant:"primary",type:"submit",children:"Save"})]})}):Object(ee.jsx)("div",{className:"spinner"})},re=(n(324),n(395)),ue=n(196),oe=n(56),le=function(){function e(){Object(D.a)(this,e),this.PLAYLIST_LIMIT=50,this.SEARCH_LIMIT=20,this.data=void 0,this.dataInitialized=!1,this.data=[]}return Object(B.a)(e,[{key:"total",value:function(){var e=Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dataInitialized){e.next=3;break}return e.next=3,this.loadSlice();case 3:return e.abrupt("return",this.data.length);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"slice",value:function(){var e=Object(m.a)(O.a.mark((function e(t,n){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSlice(t,n);case 2:return e.abrupt("return",this.data.slice(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"search",value:function(){var e=Object(m.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadAll();case 2:return e.abrupt("return",this.data.filter((function(e){return e.name.toLowerCase().includes(t.toLowerCase())})).slice(0,this.SEARCH_LIMIT));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadAll",value:function(){var e=Object(m.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSlice();case 2:t=this.PLAYLIST_LIMIT;case 3:if(!(t<this.data.length)){e.next=9;break}return e.next=6,this.loadSlice(t,t+this.PLAYLIST_LIMIT);case 6:t+=this.PLAYLIST_LIMIT,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadSlice",value:function(){var e=Object(m.a)(O.a.mark((function e(){var t,n,c,a,s,i,r=arguments;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:0,c=r.length>1&&void 0!==r[1]?r[1]:n+this.PLAYLIST_LIMIT,!this.dataInitialized){e.next=6;break}if(0!==(a=this.data.slice(n,c)).filter((function(e){return!e})).length){e.next=6;break}return e.abrupt("return",a);case 6:return e.next=8,ne(n,this.PLAYLIST_LIMIT);case 8:if(200===(s=e.sent).status){e.next=11;break}return e.abrupt("return");case 11:i=s.data,this.dataInitialized||(this.data=Array(i.total).fill(null),this.dataInitialized=!0),(t=this.data).splice.apply(t,[n,i.items.length].concat(Object(oe.a)(i.items)));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),de=le,he=function(){function e(t){Object(D.a)(this,e),this.playlist=void 0,this.playlistItems=[],this.playlist=t}return Object(B.a)(e,[{key:"trackItems",value:function(){var e=Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPlaylistItems();case 2:return e.abrupt("return",this.playlistItems);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPlaylistItems",value:function(){var e=Object(m.a)(O.a.mark((function e(){var t,n,c,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.playlistItems.length){e.next=11;break}t=100,n=0;case 3:if(!(n<this.playlist.tracks.total)){e.next=11;break}return e.next=6,ce(this.playlist.id,n,t);case 6:(a=e.sent)&&(c=this.playlistItems).push.apply(c,Object(oe.a)(a.data.items.filter((function(e){return e.track}))));case 8:n+=t,e.next=3;break;case 11:return e.abrupt("return",this.playlistItems);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),je=he,be=function(e){var t=Object(c.useContext)(Fe).setOngoingBt,n=Object(c.useState)(!1),a=Object(r.a)(n,2),s=a[0],i=a[1],u=Object(h.f)(),o=function(){var e=Object(m.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M().size>0?i(!0):l(!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),l=function(){var n=Object(m.a)(O.a.mark((function n(c){var a,s;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return c||R(),n.next=3,new je(e.playlist).getPlaylistItems();case 3:a=n.sent,s=new k(a),U(s),t(!0),u("/");case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),d=function(e){return e?Object(ee.jsx)(f.a,{icon:["far","check-circle"],size:"sm"}):Object(ee.jsx)(f.a,{icon:["far","times-circle"],size:"sm",style:{color:"#ECEBE8"}})},p=Object(ee.jsx)(f.a,{icon:["fas","music"]}),x=e.playlist;return null==x.uri?Object(ee.jsxs)("tr",{children:[Object(ee.jsx)("td",{children:p}),Object(ee.jsx)("td",{children:x.name}),Object(ee.jsx)("td",{colSpan:2,children:"This playlist is not supported"}),Object(ee.jsx)("td",{children:d(x.public)}),Object(ee.jsx)("td",{children:"\xa0"})]},x.name):Object(ee.jsxs)(ee.Fragment,{children:[s&&Object(ee.jsx)("div",{className:"spot-modal-bg",children:Object(ee.jsxs)(j.a,{className:"spot-modal",variant:"secondary",children:[Object(ee.jsx)("p",{children:"Do you want to reset the leaderboard scores ?"}),Object(ee.jsxs)("div",{className:"d-flex justify-content-center",children:[Object(ee.jsx)(b.a,{className:"mr-2",onClick:function(){return l(!1)},children:"Yes"}),Object(ee.jsx)(b.a,{className:"mr-2",onClick:function(){return l(!0)},variant:"danger",children:"No"}),Object(ee.jsx)(b.a,{onClick:function(){return i(!1)},variant:"secondary",children:"Cancel"})]})]})}),Object(ee.jsxs)("tr",{children:[Object(ee.jsx)("td",{children:p}),Object(ee.jsx)("td",{children:Object(ee.jsx)("a",{href:x.uri,children:x.name})}),Object(ee.jsx)("td",{children:Object(ee.jsx)("a",{href:x.owner.uri,children:x.owner.display_name})}),Object(ee.jsx)("td",{children:x.tracks.total}),Object(ee.jsx)("td",{children:d(x.public)}),Object(ee.jsx)("td",{className:"text-right",children:Object(ee.jsxs)(b.a,{type:"submit",variant:"primary",onClick:o,className:"text-nowrap btn-xs",children:[Object(ee.jsx)(f.a,{icon:["fas","play-circle"],size:"sm"})," Select"]})})]},x.uri)]})},fe=function(e){return Object(ee.jsx)("nav",{className:"paginator text-right",children:Object(ee.jsxs)("ul",{className:"pagination pagination-sm",children:[Object(ee.jsx)("li",{className:e.currentPage<=1?"page-item disabled":"page-item",children:Object(ee.jsx)("a",{className:"page-link",href:"#","aria-label":"Previous",onClick:function(t){t.preventDefault(),e.onPageChanged(e.currentPage-1)},children:Object(ee.jsx)("span",{"aria-hidden":"true",children:"\xab"})})}),Object(ee.jsx)("li",{className:e.currentPage>=Math.ceil(e.totalRecords/e.pageLimit)?"page-item disabled":"page-item",children:Object(ee.jsx)("a",{className:"page-link",href:"#","aria-label":"Next",onClick:function(t){t.preventDefault(),e.onPageChanged(e.currentPage+1)},children:Object(ee.jsx)("span",{"aria-hidden":"true",children:"\xbb"})})})]})})},pe=function(){var e=20,t=new de,n=Object(c.useContext)(Fe).setSubtitle,a=Object(c.useState)(!1),s=Object(r.a)(a,2),i=s[0],u=s[1],o=Object(c.useState)(""),l=Object(r.a)(o,2),d=l[0],h=l[1],j=Object(c.useState)(!1),b=Object(r.a)(j,2),p=b[0],x=b[1],g=Object(c.useState)([]),v=Object(r.a)(g,2),D=v[0],y=v[1],C=Object(c.useState)(0),k=Object(r.a)(C,2),F=k[0],A=k[1],w=Object(c.useState)(1),B=Object(r.a)(w,2),E=B[0],S=B[1];Object(c.useEffect)((function(){var t=(E-1)*e+1,c=Math.min(t+e-1,F);n("".concat(t,"-").concat(c," of ").concat(F," playlists"))}),[n,E,F]),Object(c.useEffect)((function(){N()}),[E]);var I=function(){var e=Object(m.a)(O.a.mark((function e(){var c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==d.length){e.next=4;break}_(),e.next=12;break;case 4:return u(!0),e.next=7,t.search(d);case 7:c=e.sent,y(c),A(c.length),S(1),c.length===t.SEARCH_LIMIT?n("First ".concat(c.length,' results with "').concat(d,'" in playlist name')):n("".concat(c.length,' results with "').concat(d,'" in playlist name'));case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){return u(!1),N()},N=function(){var n=Object(m.a)(O.a.mark((function n(){var c,a;return O.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return h(""),n.next=3,t.slice((E-1)*e,(E-1)*e+e);case 3:return c=n.sent,x(!0),y(c),n.next=8,t.total();case 8:a=n.sent,A(a);case 10:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),z=function(e){S(e)};if(p){var L=i?Object(ee.jsx)(f.a,{icon:["fas","times"],size:"sm",onClick:_,className:"closeIcon"}):Object(ee.jsx)(f.a,{icon:["fas","search"],size:"sm",onClick:I,className:"searchIcon"}),T=d.length>0?"search queryPresent":"search";return Object(ee.jsxs)("div",{id:"playlists",children:[Object(ee.jsxs)("div",{id:"playlistsHeader",children:[Object(ee.jsx)(fe,{currentPage:E,pageLimit:e,totalRecords:F,onPageChanged:z}),Object(ee.jsx)(se.a,{className:T,children:Object(ee.jsxs)(re.a,{children:[Object(ee.jsx)(ue.a,{value:d,type:"text",role:"searchbox",placeholder:"Search",size:"sm",onChange:function(e){return h(e.target.value)},onKeyDown:function(e){e.stopPropagation(),"Enter"===e.key?(I(),e.preventDefault()):"Escape"===e.key&&_()},className:"border-right-0 border"}),Object(ee.jsx)(re.a.Text,{className:"bg-transparent",children:L})]})})]}),Object(ee.jsxs)("table",{className:"table table-hover table-sm",children:[Object(ee.jsx)("thead",{children:Object(ee.jsxs)("tr",{children:[Object(ee.jsx)("th",{style:{width:"30px"}}),Object(ee.jsx)("th",{children:"Name"}),Object(ee.jsx)("th",{style:{width:"150px"},children:"Owner"}),Object(ee.jsx)("th",{style:{width:"100px"},children:"Tracks"}),Object(ee.jsx)("th",{style:{width:"120px"},children:"Public?"}),Object(ee.jsx)("th",{style:{width:"100px"},children:" "})]})}),Object(ee.jsx)("tbody",{children:D.map((function(e){return Object(ee.jsx)(be,{playlist:e},e.id)}))})]}),Object(ee.jsx)("div",{id:"playlistsFooter",children:Object(ee.jsx)(fe,{currentPage:E,pageLimit:e,totalRecords:F,onPageChanged:z})})]})}return Object(ee.jsx)("div",{className:"spinner"})},Oe=function(){var e=Object(c.useContext)(Fe).setOngoingBt;return Object(ee.jsx)(b.a,{id:"listButton",className:"topButtons",type:"submit",variant:"link",size:"lg",onClick:function(){G(),e(!1)},title:"Playlists",children:Object(ee.jsx)(f.a,{icon:["fas","list"],size:"lg"})})},me=function(){var e=Object(c.useContext)(Fe),t=e.setLoggedIn,n=e.setOngoingBt,a=e.setConfigured,s=Object(h.f)();return Object(ee.jsx)(b.a,{id:"logoutButton",className:"topButtons",type:"submit",variant:"link",size:"lg",onClick:function(){localStorage.removeItem("refresh_token"),T(),G(),R(),localStorage.removeItem("settings"),t(!1),n(!1),a(!1),s("/")},title:"Logout",children:Object(ee.jsx)(f.a,{icon:["fas","sign-out-alt"],size:"lg"})})},xe=function(){var e=Object(h.f)();return Object(ee.jsx)(b.a,{id:"settingButton",className:"topButtons",type:"submit",variant:"link",size:"lg",onClick:function(){e("/settings")},title:"Settings",children:Object(ee.jsx)(f.a,{icon:["fas","cog"],size:"lg"})})},ge=n(200),ve=null,De=function(){},ye=function(){var e=Object(c.useContext)(Fe).setSubtitle,t=Object(c.useState)((function(){return Object(A.a)(k,localStorage.getItem("blind_test_tracks")||"{}")})),n=Object(r.a)(t,1)[0],a=Object(c.useState)((function(){return P()})),s=Object(r.a)(a,1)[0],i=Object(c.useState)(n.doneTracks),u=Object(r.a)(i,2),o=u[0],l=u[1],d=Object(c.useState)((function(){return M()})),h=Object(r.a)(d,2),j=h[0],p=h[1],x=Object(c.useState)(""),g=Object(r.a)(x,2),v=g[0],D=g[1],y=Object(c.useState)(!1),C=Object(r.a)(y,2),F=C[0],w=C[1],B=Object(c.useState)(!1),E=Object(r.a)(B,2),S=E[0],I=E[1],N=Object(c.useState)(!1),z=Object(r.a)(N,2),L=z[0],T=z[1],R=Object(c.useState)([]),G=Object(r.a)(R,2),Y=G[0],V=G[1],q=Object(c.useState)([]),K=Object(r.a)(q,2),W=K[0],X=K[1],Q=Object(c.useState)(""),Z=Object(r.a)(Q,2),te=Z[0],ne=Z[1];Object(c.useEffect)((function(){return function(e,t){var n={channels:[e]};t&&(n.identity={username:"foo",password:_()||""}),(ve=new ge.Client(n)).connect(),ve.on("message",(function(e,t,n){return De(t["display-name"],n)}))}(s.twitchChannel,s.chatNotifications),function(){null!==ve&&ve.disconnect()}}),[s.twitchChannel]),Object(c.useEffect)((function(){S?e("Playing song #".concat(o," out of ").concat(n.tracks.length)):n.tracks.length-o>0?e("".concat(n.tracks.length-o," tracks left")):e("Blind-test is finished !")}),[e,n.tracks.length,S,o]);var ce=function(){n.doneTracks=o,U(n),function(e){localStorage.setItem("blind_test_scores",Object(A.b)(e))}(j)};De=function(e,t){if(se(e),S)for(var n=H(t),c=0;c<W.length;c++){if(!Y[c].guessed){var a=W[c];if(J(n,a.toGuess)<=a.maxDistance||n.includes(a.toGuess)&&n.length<=1.6*a.toGuess.length){var i,r=1+(Y.find((function(t){return t.guessed&&t.guessedBy===e}))?1:0);ie(e,r),re(c,e,r),null===(i=ve)||void 0===i||i.say(s.twitchChannel,"\u2705 ".concat(e," correctly guessed [").concat(a.toGuess,"] +").concat(r))}}}};var se=function(e){s.addEveryUser&&!j.get(e)&&ie(e,0)},ie=function(e,t){var n=new Map(j);n.set(e,(n.get(e)||0)+t),p(n)},re=function(e,t,n){var c=new Array;Y.forEach((function(a,s){s===e?c.push({guessed:!0,guessedBy:t,points:n}):c.push({guessed:a.guessed,guessedBy:a.guessedBy,points:a.points})})),V(c)},le=function(){return S&&Y.reduce((function(e,t){return e&&t.guessed}),!0)},de=function(){var e=Object(m.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ce(),t=n.tracks[o],I(!1),w(!0),(c=t.uri,a=t.offset,i=s.deviceId,$.put("https://api.spotify.com/v1/me/player/play?device_id=".concat(i),{context_uri:c,offset:{position:a}})).then((function(){ae(!0,s.deviceId),l(o+1),X([t.title].concat(Object(oe.a)(t.artists))),V(new Array(t.artists.length+1).fill({guessed:!1})),ne(t.img),I(!0),T(!1),w(!1)})).catch((function(){w(!1)}));case 5:case"end":return e.stop()}var c,a,i}),e)})));return function(){return e.apply(this,arguments)}}(),he=Object(ee.jsx)(f.a,{color:"#de281b",icon:["fas","times"],size:"lg"}),je=Object(ee.jsx)(f.a,{icon:["far","comment"],size:"lg"}),be=Object(ee.jsx)(f.a,{color:"#18ad1d",icon:["fas","check"],size:"lg"}),fe=function(e){var t=e.guessable,n=e.guess;return n.guessed?Object(ee.jsxs)("div",{className:"pb-3",children:[Object(ee.jsxs)("div",{className:"bt-orig",children:[n.guessedBy?be:he," ",t.original]}),Object(ee.jsxs)("div",{className:"bt-tg",children:["[",Object(ee.jsx)("i",{children:t.toGuess}),"]"]}),n.guessedBy&&Object(ee.jsxs)("div",{className:"bt-gb",children:[je," ",n.guessedBy," ",Object(ee.jsxs)("b",{children:["[+",n.points,"]"]})]})]}):Object(ee.jsxs)("div",{className:"pb-3",children:[he,Object(ee.jsx)("div",{className:"bt-orig",style:{fontWeight:"bold"},children:"\xa0?"})]})};return Object(ee.jsx)("div",{id:"blindtest",children:Object(ee.jsxs)("div",{className:"row align-items-md-stretch mb-4",children:[Object(ee.jsxs)("div",{className:"col-md-6",children:[Object(ee.jsx)("div",{id:"title",className:"p-3 mb-2 bg-light border rounded-3",children:Object(ee.jsxs)("div",{id:"cover",children:[le()&&Object(ee.jsx)("img",{id:"cover-image",src:te,alt:"album cover"}),(S||F)&&!le()&&Object(ee.jsx)(f.a,{icon:["fas","question"],size:"sm"}),!S&&!F&&Object(ee.jsx)(f.a,{icon:["fas","volume-mute"],size:"sm"})]})}),Object(ee.jsxs)("div",{id:"title",className:"p-3 mb-2 bg-light border rounded-3",children:[Object(ee.jsx)("div",{className:"bt-h",children:Object(ee.jsx)("h2",{children:"TITLE"})}),S&&Object(ee.jsx)("div",{children:Object(ee.jsx)(fe,{guessable:W[0],guess:Y[0]},"guess_0")})]}),Object(ee.jsxs)("div",{id:"artists",className:"p-3 mb-2 bg-light border rounded-3",children:[Object(ee.jsx)("div",{className:"bt-h",children:Object(ee.jsx)("h2",{children:"ARTIST(S)"})}),S&&Object(ee.jsx)("div",{children:W.slice(1).map((function(e,t){return Object(ee.jsx)(fe,{guessable:e,guess:Y[t+1]},"guess_"+(t+1))}))})]})]}),Object(ee.jsxs)("div",{className:"col-md-6",children:[Object(ee.jsxs)("div",{id:"player",className:"mb-2",style:{display:"flex"},children:[Object(ee.jsxs)(b.a,{style:{width:"30%"},id:"nextButton",disabled:F||o>=n.tracks.length,type:"submit",variant:"outline-secondary",size:"sm",onClick:de,title:"Next",children:[Object(ee.jsx)(f.a,{icon:["fas","step-forward"],color:"#84BD00",size:"sm"})," NEXT"]}),"\xa0",L&&Object(ee.jsxs)(b.a,{style:{width:"30%"},id:"resumeButton",disabled:!S,type:"submit",variant:"outline-secondary",size:"sm",onClick:function(){var e;e=s.deviceId,$.put("https://api.spotify.com/v1/me/player/play?device_id=".concat(e)),T(!1)},title:"Resume",children:[Object(ee.jsx)(f.a,{icon:["fas","play"],color:"#84BD00",size:"sm"})," RESUME"]}),!L&&Object(ee.jsxs)(b.a,{style:{width:"30%"},id:"pauseButton",disabled:!S,type:"submit",variant:"outline-secondary",size:"sm",onClick:function(){var e;e=s.deviceId,$.put("https://api.spotify.com/v1/me/player/pause?device_id=".concat(e)),T(!0)},title:"Pause",children:[Object(ee.jsx)(f.a,{icon:["fas","pause"],color:"#84BD00",size:"sm"})," PAUSE"]}),"\xa0",Object(ee.jsxs)(b.a,{style:{width:"30%"},id:"revealButton",disabled:!S||le(),type:"submit",variant:"outline-secondary",size:"sm",onClick:function(){ce();var e=new Array;Y.forEach((function(t){e.push({guessed:!0,guessedBy:t.guessedBy,points:t.points})})),V(e)},title:"Reveal",children:[Object(ee.jsx)(f.a,{icon:["fas","eye"],color:"#84BD00",size:"sm"})," REVEAL"]}),"\xa0",Object(ee.jsx)(ue.a,{value:v,type:"text",role:"searchbox",placeholder:"Nick filter",size:"sm",onChange:function(e){return D(e.target.value.toLowerCase())},className:"border"})]}),Object(ee.jsx)("div",{id:"leaderboard",className:"p-3 bg-light border rounded-3",children:Object(ee.jsxs)("table",{className:"table-hover bt-t",children:[Object(ee.jsx)("thead",{children:Object(ee.jsxs)("tr",{children:[Object(ee.jsx)("th",{style:{width:"60px"},children:"Rank"}),Object(ee.jsx)("th",{style:{width:"270px"},children:"Nick"}),Object(ee.jsx)("th",{style:{width:"60px"},children:"Score"}),Object(ee.jsx)("th",{style:{width:"100px"}})]})}),Object(ee.jsx)("tbody",{children:function(){var e=[],t=[];j.forEach((function(n,c){e.push({nick:c,score:n}),t.includes(n)||t.push(n)})),t.sort((function(e,t){return t-e})),e.sort((function(e,t){return e.nick.localeCompare(t.nick)})),e.sort((function(e,t){return t.score-e.score})),v&&(e=e.filter((function(e){return e.nick.toLowerCase().includes(v)})));for(var n=0;n<e.length;n++)0!==n&&e[n].score===e[n-1].score||(e[n].rank=1+t.indexOf(e[n].score));return e}().map((function(e,t){return Object(ee.jsxs)("tr",{children:[Object(ee.jsx)("td",{children:e.rank}),Object(ee.jsx)("td",{children:e.nick}),Object(ee.jsx)("td",{children:e.score}),Object(ee.jsxs)("td",{className:"text-right",children:[Object(ee.jsx)(b.a,{type:"submit",variant:"primary",size:"sm",onClick:function(){return ie(e.nick,-1)},className:"text-nowrap",children:Object(ee.jsx)(f.a,{icon:["fas","minus"],size:"sm"})}),"\xa0",Object(ee.jsx)(b.a,{type:"submit",variant:"primary",size:"sm",onClick:function(){return ie(e.nick,1)},className:"text-nowrap",children:Object(ee.jsx)(f.a,{icon:["fas","plus"],size:"sm"})})]})]},"score_"+t)}))})]})})]})]})})},Ce=function(){var e=Object(c.useContext)(Fe).setLoggedIn,t=Object(h.f)();return Object(c.useEffect)((function(){var n=I("code",window.location.search);n?Q(n).then((function(n){z(n.data.refresh_token);var c=n.data.access_token;L(c),$.defaults.headers.common.Authorization="Bearer ".concat(c),e(!0),t("/")})):t("/")}),[t,e]),Object(ee.jsx)("div",{className:"spinner"})};var ke=function(){var e=Object(h.f)(),t=Object(c.useState)((function(){return null!==N()})),n=Object(r.a)(t,2),a=n[0],s=n[1],i=Object(c.useState)((function(){return P().isInitialized()})),u=Object(r.a)(i,2),o=u[0],l=u[1],d=Object(c.useState)((function(){return null!==localStorage.getItem("blind_test_tracks")})),p=Object(r.a)(d,2),O=p[0],m=p[1],x=Object(c.useState)(Object(ee.jsx)("div",{})),g=Object(r.a)(x,2),v=g[0],D=g[1],y=Object(c.useState)(""),C=Object(r.a)(y,2),k=C[0],F=C[1],A=Object(c.useState)(""),w=Object(r.a)(A,2),B=w[0],E=w[1],S={loggedIn:a,setLoggedIn:s,configured:o,setConfigured:l,ongoingBt:O,setOngoingBt:m,subtitle:k,setSubtitle:F};return Object(c.useEffect)((function(){W=function(e){E(e)}}),[]),Object(c.useEffect)((function(){a?o?D(O?Object(ee.jsx)(ye,{}):Object(ee.jsx)(pe,{})):e("/settings"):D(Object(ee.jsx)(te,{}))}),[e,a,o,O]),Object(ee.jsx)(Fe.Provider,{value:S,children:Object(ee.jsxs)("div",{className:"App container",children:[B&&Object(ee.jsx)("div",{className:"spot-modal-bg",children:Object(ee.jsxs)(j.a,{className:"spot-modal",variant:"danger",children:[Object(ee.jsx)(j.a.Heading,{children:"Error"}),Object(ee.jsxs)("p",{children:["Spotify server returned : ",B]}),Object(ee.jsx)("div",{className:"d-flex justify-content-center",children:Object(ee.jsx)(b.a,{onClick:function(){E(""),e("/")},variant:"outline-danger",children:"Close"})})]})}),Object(ee.jsxs)("header",{className:"App-header",children:[Object(ee.jsxs)("div",{style:{position:"absolute",right:0},children:[O&&Object(ee.jsx)(Oe,{}),a&&Object(ee.jsx)(xe,{}),a&&Object(ee.jsx)(me,{})]}),Object(ee.jsxs)("h1",{children:[Object(ee.jsx)(f.a,{icon:["fab","spotify"],color:"#84BD00",size:"sm"})," ",Object(ee.jsx)("a",{href:"/",children:"BlindTesTwitch"})]}),Object(ee.jsx)("p",{id:"subtitle",className:"lead text-secondary",children:k})]}),Object(ee.jsxs)(h.c,{children:[Object(ee.jsx)(h.a,{path:"/",element:v}),Object(ee.jsx)(h.a,{path:"/callback",element:Object(ee.jsx)(Ce,{})}),Object(ee.jsx)(h.a,{path:"/settings",element:Object(ee.jsx)(ie,{})})]})]})})},Fe=Object(c.createContext)({loggedIn:!1,setLoggedIn:function(e){},configured:!1,setConfigured:function(e){},ongoingBt:!1,setOngoingBt:function(e){},subtitle:"",setSubtitle:function(e){}}),Ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,396)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),s(e),i(e)}))},we=n(35);n(341).shim(),i.a.render(Object(ee.jsx)(a.a.StrictMode,{children:Object(ee.jsx)(we.a,{basename:"/BlindTesTwitch",children:Object(ee.jsx)(ke,{})})}),document.getElementById("root")),Ae()}},[[388,1,2]]]);
//# sourceMappingURL=main.d88795bd.chunk.js.map